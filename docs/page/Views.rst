============
View's
============


Participant View
----------------

Главная страница портала. Предназначена для визуализации данных полученных от *Fitbit*. Также содержит эллементы для удобного выбора *Participant* и список их *Intervention*. 

.. image:: /_static/Images/Figure_9.png
   :target: ../../_static/Images/Figure_9.png

*Figure 1 - Participant View Page Interface*

Описание Participant View Page Interface:
    1. краткая учетная информация пользователя, также содежит ссылку на Group View (LINK!)
    2. выбор *study* к группе которого привязан пользователь
    3. выбор координатора *Study Group* к которой привязан пользоватеоей
    4. список всех *Participants* выбранного *Clinician* в данной *Study*
    5. выбор временного периода для отображения данных
    6. график веса, полученного от *Fitbit*
    7. график еды, полученной от *Fitbit*. Также есть возможность просмотреть детализированный список еды за этот день по щелчку на соответсвующем дне графика. (смотрите *Figure 2*)
    8. график активности полученный от *Fitbit*. Также есть возможность просмотреть детализированный список активности за этот день по щелчку на соответсвующем дне графика. (смотрите *Figure 3*)
    9. ссылка на настройки *Inteventions*
    10. поиск по таблице *Inteventions*
    11. таблица *Inteventions* пользователя
    12. ссылка на обработку данного *Intevention*, с пометкой о том был ли обработан *Intevention* (зеленое) или нет (красное)

.. note:: В таблице *Inteventions* на данной странице не отображатся *Inteventions* типа *Autotext*, время отправки которых еще не наступило, и *Inteventions* типа *Notification*

.. image:: /_static/Images/Figure_10.png
   :target: ../../_static/Images/Figure_10.png

*Figure 2 - Окно с детальным логом еды, вызванное при клике на графике калорий*

.. image:: /_static/Images/Figure_11.png
   :target: ../../_static/Images/Figure_11.png

*Figure 3 - Окно с детальным логом активности, вызванное при клике на графике активности*

Study Coordinator View
----------------------

Страница содержит агрегированные данные полученные от *Fitbit*, а также агрегированные данные о *Inteventions* пользователя.

.. note:: Данные выбираются для периода выбранного в элементах управления страницей, по умолчанию это период охватывает 30 дней заканчивая текущим днем.

Все данные представлены в виде трех таблиц:
    * **Average data**
    * **Block data**
    * **Raw data**

Таблица **Average Data** – содержит данные общие данные о интервеншенах пользователя.

Колонки таблицы **Average Data**:
    * **Intervention** - тип *Intervention*
    * **Cost** - относительная стоимость *Intervention*, настраивается на странице Edit study (link)
    * **Count** - Количество *интервеншенов* этого типа
    * **RsAvg** - средний RS *интервеншенов* этого типа), данные значения должны соответсвовать данным для расчета в expression для групп с групповой оптимизацией, а также отображаемые на странице Group View (для корректного отображения должнен быть выбран период охватывающий все интервеншены)
    * **WeightedRsAvg** - среднее значение **(DecayWeight ^ Number)** *интервеншенов* этого типа, где **DecayWeight** константа, настраивается на странице Edit study(link), Number – порядковый номер каждого интервеншена отсортированного по дате в порядке убывания начиная с нуля.

Таблица **Block data** - список *интервеншенов* с соответсвующими им временными периодами (блоками), с общими данными для каждого.

Колонки таблицы **Block data**:
    * **Date** - дата *intervention*
    * **Duration** - длительность *intervention* в целых днях, начиная с даты *intervention* назад, включительно. (Например intervention 10/27/2017 и длительностью 4 включает 4 дня: 10/27/2017, 10/26/2017 , 10/25/2017 , 10/24/2017)
    * **Weekend Days** - количество дней которые пришлись на выходные
    * **Intervention** - тип *intervention*
    * **RS** - reward score для этого *intervention* (средний RS среди всех дней связанного периода), данные значения должны соответсвовать данным для расчета в expression для групп с индивидуальной оптимизацией (для корректного отображения должнен быть выбран период охватывающий все интервеншены)
    * **Weight (for RS)** - соответсвует **WeightedRsAvg** из таблицы *Average Data*, но для конкретного *Intervention*

Таблица **Raw data** - агрегированные по дням данные полученные от *Fitbit*.

.. note:: Данные в данной таблице указываются только для тех дней для которых получены хоть какие то данные от *Fitbit*.

Колонки таблицы **Raw Data**:
    * **Date** – дата за каторую агрегируются данные
    * **Weight** – последний вес полученный от *Fitbit*
    * **Food logged** – количество еды (записей) полученных от *Fitbit*
    * **Food calories logged** – суммарная калорийность еды полученной от *Fitbit*
    * **Calories goal** – цель по калориям, устанавливается в настройках *Study* к группе которого привязан пользователь
    * **Steps** – количество шагов полученных в активности от *Fitbit*
    * **Steps goal** - цель по шагам, устанавливается в настройках *Study* к группе которого привязан пользователь
    * **Activity minutes** – сумма минут активности полученных в активности от *Fitbit*
    * **Activity minutes goal** - цель по минутам активности, устанавливается в настройках *Study* к группе которого привязан пользователь
    * **PA goal freq** – устнавливается значение 1 если в этот день данные по активности больше или равны цели соответствующего типа активности, тип активности выбирается в зависимости от значения **StudyAlgorithm** (устанавливается в настройках *Study* к группе которого привязан пользователь)
    * **Weight freq** – устанавливается значение 1 если полученны данные о весе за этот день
    * **Food trak freq** – устанавливается значение 1 если количество записей еды за этот день больше нуля
    * **Cal goal freq** – устанавливается значение 1 если сумма калорий всех записей еды за этот день находится в промежутке между **Minimum Reported Calories** и **Calories Goal** (**Minimum Reported Calories** устанавливается в настройках *Study* к группе которого привязан пользователь)
    * **Weight Loss (1 day)** -  потеря веса за этот день (относительно предыдущего дня, 0 если нет данных за этот или предыдущий день)
    * **Weight Loss (7 day)** -  потеря веса за эту неделю (относительно даты неделю назад, 0 если нет данных за этот день)
    * **Weight Loss (14 day)** -  потеря веса за две недели (относительно даты две недели назад, 0 если нет данных за этот день)
    * **RS** – Reward Score за этот день, данное значение хранится в базе данных и обновляется при каждом получении данных от *Fitbit* за этот день на основе RS expression указанного для *Study* к группе которого привязан пользователь, если пользователь не привязан ни к одному *Study*, то RS не может быть расчитан. Данные значения RS используются при расчете среднего RS для *Intervention* (для корректного отображения должнен быть выбран период охватывающий все интервеншены).

.. warning::  Если *Participant* не состоит ни в одной *Study Group*, то RS для него не может быть расчитан.


Group View
----------

Страница Group view содержит список всех пользователей *Study Group*, с агригированными данными интервеншенов и индивидуальными целями пользователя. 
 
.. image:: /_static/Images/Figure_12.png
   :target: ../../_static/Images/Figure_12.png

*Figure 3 - Group View Interface*

Описание Group View Interface:
    1. элемент для выбора выбор группы
    2. ссылка на редактировнаие группы
    3. сссылка на управление всеми группами Study к которой привязана группа
    4. ссылка на редактирование Study к которой привязана группа
    5. поиск по таблице с данными
    6. колона таблицы с именем пользователся, так же является ссылкой на страницу Participant view(LINK!)
    7. уникальный идентификатор пользователя, устанавливается на странице редактирования пользователя, может быть пустым
    8. колонка указывающая список всех типов интервеншенов с количеством интервеншенов каждого типа, учитываются только интервеншены которые были созданы когда пользователь находился в текущем study.
    9. колонка указывающая список всех типов интервеншенов с средним RS для каждого типа, учитываются только интервеншены которые были созданы когда пользователь находился в текущем study. Данные должны соответсвовать данным на странице Study Coordinator View (должен быть выбран период охватывающий все интервеншены) (LINK!)
    10. колонка отображающая индивидуальные цели пользователя, а также эллементы управления ими
    11. указывает текущие цели пользователя по калориям и активности
    12. указывает источник целей (индивидуальные или Study)
    13. элемнт для вызова меню управления индивидуальными целями


.. image:: /_static/Images/Figure_13.png
   :target: ../../_static/Images/Figure_13.png

*Окно управления индивидуальными целями* 

Описание Окно управления индивидуальными целями:
    1. индивидуальная цель по калориям, если не уставнолена 0
    2. цель по калориям соответсвующая цели по калориям Study в группе оторого состоит пользователь
    3. цель  по калориям полученная от фитбит, может менятся более 10 раз за день подробнее можно почитать на странице фитбит (ссылка)
    4. попытка принудительного получения цели по калориям от фитбит
    5. выбор типа цели по калориям который будет использоваться для пользователя
    6. индивидуальная цель по шагам, если не уставнолена 0
    7. выбор типа цели который по шагам будет использоваться для пользователя; индивидуальная цель по минутам активности, если не уставнолена 0
    8. выбор типа цели  по минутам активности  который будет использоваться для пользователя
    9. сохранить изменения
 
